<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCAB Shared Ecosystem - Test Page</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0a0a;
            color: #00eeff;
            font-family: 'Courier New', monospace;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            border-bottom: 3px solid #00eeff;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00eeff;
        }
        
        .beta-badge {
            display: inline-block;
            background: #ff0055;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .component-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid;
            border-radius: 10px;
            padding: 20px;
            transition: transform 0.3s;
        }
        
        .component-card:hover {
            transform: translateY(-5px);
        }
        
        .component-card.auth { border-color: #00eeff; }
        .component-card.events { border-color: #ffaa00; }
        .component-card.state { border-color: #9d00ff; }
        .component-card.api { border-color: #00ffaa; }
        .component-card.sync { border-color: #ff0055; }
        
        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .component-name {
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .component-status {
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        
        .status-active {
            background: #00c851;
            color: white;
        }
        
        .status-inactive {
            background: #ff4444;
            color: white;
        }
        
        .component-actions {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        button {
            background: #333;
            color: white;
            border: 2px solid currentColor;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
        }
        
        button:hover {
            background: currentColor;
            color: #0a0a0a;
        }
        
        .btn-auth { color: #00eeff; }
        .btn-events { color: #ffaa00; }
        .btn-state { color: #9d00ff; }
        .btn-api { color: #00ffaa; }
        .btn-sync { color: #ff0055; }
        
        .output {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.9em;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .logs {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
            margin-top: 40px;
        }
        
        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        #log-output {
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }
        
        .log-time {
            color: #888;
            margin-right: 10px;
        }
        
        .log-info { color: #00eeff; }
        .log-success { color: #00ffaa; }
        .log-warning { color: #ffaa00; }
        .log-error { color: #ff0055; }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #333;
            color: #888;
            font-size: 0.9em;
        }
        
        .instructions {
            background: rgba(0, 238, 255, 0.1);
            border-left: 4px solid #00eeff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 5px 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>GCAB Shared Ecosystem <span class="beta-badge">BETA</span></h1>
            <p>Test Interface for Sync System Components</p>
        </header>
        
        <div class="instructions">
            <p>ðŸŽ¯ This page tests the shared ecosystem components. All components should auto-initialize.</p>
            <p>ðŸ”— Open this page in multiple tabs to test cross-tab synchronization.</p>
            <p>ðŸ”„ Check browser console for detailed logs.</p>
        </div>
        
        <div class="components-grid">
            <!-- Auth Component -->
            <div class="component-card auth">
                <div class="component-header">
                    <div class="component-name">Authentication</div>
                    <div id="auth-status" class="component-status status-inactive">Disconnected</div>
                </div>
                <p>Manages wallet connections and player sessions.</p>
                <div class="component-actions">
                    <button class="btn-auth" onclick="connectWallet()">Connect Wallet</button>
                    <button class="btn-auth" onclick="disconnectWallet()">Disconnect</button>
                    <button class="btn-auth" onclick="getAuthData()">Get Data</button>
                </div>
                <div id="auth-output" class="output">Click buttons to see output...</div>
            </div>
            
            <!-- Events Component -->
            <div class="component-card events">
                <div class="component-header">
                    <div class="component-name">Event Bridge</div>
                    <div id="events-status" class="component-status status-active">Active</div>
                </div>
                <p>Handles real-time events between Panel and Game.</p>
                <div class="component-actions">
                    <button class="btn-events" onclick="emitTestEvent()">Emit Test Event</button>
                    <button class="btn-events" onclick="getEventHistory()">Get History</button>
                    <button class="btn-events" onclick="clearEvents()">Clear Events</button>
                </div>
                <div id="events-output" class="output">Events will appear here...</div>
            </div>
            
            <!-- State Component -->
            <div class="component-card state">
                <div class="component-header">
                    <div class="component-name">State Manager</div>
                    <div id="state-status" class="component-status status-active">Synced</div>
                </div>
                <p>Manages shared state between components.</p>
                <div class="component-actions">
                    <button class="btn-state" onclick="getState()">Get State</button>
                    <button class="btn-state" onclick="updateState()">Update State</button>
                    <button class="btn-state" onclick="clearState()">Clear State</button>
                </div>
                <div id="state-output" class="output">State data will appear here...</div>
            </div>
            
            <!-- API Component -->
            <div class="component-card api">
                <div class="component-header">
                    <div class="component-name">API Client</div>
                    <div id="api-status" class="component-status status-active">Ready</div>
                </div>
                <p>Handles all API communications.</p>
                <div class="component-actions">
                    <button class="btn-api" onclick="getMarketPrice()">Get Price</button>
                    <button class="btn-api" onclick="getPlayerStats()">Get Player Stats</button>
                    <button class="btn-api" onclick="getEcosystemStats()">Get Ecosystem</button>
                </div>
                <div id="api-output" class="output">API responses will appear here...</div>
            </div>
            
            <!-- Sync Component -->
            <div class="component-card sync">
                <div class="component-header">
                    <div class="component-name">Sync Engine</div>
                    <div id="sync-status" class="component-status status-active">Running</div>
                </div>
                <p>Orchestrates synchronization between all components.</p>
                <div class="component-actions">
                    <button class="btn-sync" onclick="forceSync()">Force Sync</button>
                    <button class="btn-sync" onclick="getSyncStatus()">Get Status</button>
                    <button class="btn-sync" onclick="pauseSync()">Pause Sync</button>
                    <button class="btn-sync" onclick="resumeSync()">Resume Sync</button>
                </div>
                <div id="sync-output" class="output">Sync status will appear here...</div>
            </div>
        </div>
        
        <div class="logs">
            <div class="logs-header">
                <h3>System Logs</h3>
                <button onclick="clearLogs()">Clear Logs</button>
            </div>
            <div id="log-output">
                <div class="log-entry">
                    <span class="log-time">00:00:00</span>
                    <span class="log-info">System initialized. Waiting for actions...</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>GCAB Shared Ecosystem v0.9.9 | Alpha flex, Beta vibes, Forever.</p>
            <p>Open browser console (F12) for detailed debugging information.</p>
        </footer>
    </div>
    
    <!-- Load shared components -->
    <script src="config.js"></script>
    <script src="utils.js"></script>
    <script src="auth-shared.js"></script>
    <script src="event-bridge.js"></script>
    <script src="state-manager.js"></script>
    <script src="api-client.js"></script>
    <script src="sync-engine.js"></script>
    
    <script>
        // Test page functionality
        let logCount = 0;
        
        function log(message, type = 'info') {
            logCount++;
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry`;
            logEntry.innerHTML = `
                <span class="log-time">${time}</span>
                <span class="log-${type}">${message}</span>
            `;
            
            const logOutput = document.getElementById('log-output');
            logOutput.appendChild(logEntry);
            logOutput.scrollTop = logOutput.scrollHeight;
            
            // Keep only last 50 logs
            if (logOutput.children.length > 50) {
                logOutput.removeChild(logOutput.firstChild);
            }
        }
        
        function clearLogs() {
            document.getElementById('log-output').innerHTML = '';
            log('Logs cleared', 'info');
        }
        
        function updateOutput(elementId, data) {
            const output = document.getElementById(elementId);
            output.textContent = typeof data === 'object' ? 
                JSON.stringify(data, null, 2) : 
                String(data);
            output.scrollTop = output.scrollHeight;
        }
        
        // Auth functions
        async function connectWallet() {
            log('Connecting wallet...', 'info');
            try {
                const wallet = await window.GCABAuth.connectWallet();
                document.getElementById('auth-status').className = 'component-status status-active';
                document.getElementById('auth-status').textContent = 'Connected';
                updateOutput('auth-output', { success: true, wallet });
                log(`Wallet connected: ${GCABUtils.truncateAddress(wallet)}`, 'success');
            } catch (error) {
                updateOutput('auth-output', { error: error.message });
                log(`Wallet connection failed: ${error.message}`, 'error');
            }
        }
        
        function disconnectWallet() {
            window.GCABAuth.disconnect();
            document.getElementById('auth-status').className = 'component-status status-inactive';
            document.getElementById('auth-status').textContent = 'Disconnected';
            updateOutput('auth-output', { disconnected: true });
            log('Wallet disconnected', 'info');
        }
        
        function getAuthData() {
            const data = window.GCABAuth.getPlayerData();
            updateOutput('auth-output', data || 'No auth data');
            log('Auth data retrieved', 'info');
        }
        
        // Event functions
        function emitTestEvent() {
            const eventData = {
                test: true,
                timestamp: Date.now(),
                message: 'Test event from debug page'
            };
            
            window.GCABEventBridge.emit('test:debug', eventData);
            updateOutput('events-output', { event: 'test:debug', data: eventData });
            log('Test event emitted', 'info');
        }
        
        function getEventHistory() {
            const history = window.GCABEventBridge.getEventHistory(10);
            updateOutput('events-output', history);
            log('Event history retrieved', 'info');
        }
        
        function clearEvents() {
            window.GCABEventBridge.clearEventHistory();
            updateOutput('events-output', 'Event history cleared');
            log('Event history cleared', 'info');
        }
        
        // State functions
        function getState() {
            const state = window.GCABStateManager.getState();
            updateOutput('state-output', state);
            log('State retrieved', 'info');
        }
        
        function updateState() {
            const updates = {
                test: {
                    debug: true,
                    lastUpdate: Date.now(),
                    random: Math.random()
                }
            };
            
            window.GCABStateManager.setState(updates, 'debug');
            updateOutput('state-output', { updated: true, updates });
            log('State updated', 'info');
        }
        
        function clearState() {
            window.GCABStateManager.clear();
            updateOutput('state-output', 'State cleared');
            log('State cleared', 'warning');
        }
        
        // API functions
        async function getMarketPrice() {
            log('Fetching market price...', 'info');
            try {
                const data = await window.GCABAPI.getGCABPrice();
                updateOutput('api-output', data);
                log('Market price retrieved', 'success');
            } catch (error) {
                updateOutput('api-output', { error: error.message });
                log(`API error: ${error.message}`, 'error');
            }
        }
        
        async function getPlayerStats() {
            log('Fetching player stats...', 'info');
            try {
                const wallet = window.GCABAuth.getPlayerData()?.wallet || '0x1234567890abcdef1234567890abcdef12345678';
                const data = await window.GCABAPI.getPlayerStats(wallet);
                updateOutput('api-output', data);
                log('Player stats retrieved', 'success');
            } catch (error) {
                updateOutput('api-output', { error: error.message });
                log(`API error: ${error.message}`, 'error');
            }
        }
        
        async function getEcosystemStats() {
            log('Fetching ecosystem stats...', 'info');
            try {
                const data = await window.GCABAPI.getEcosystemStats();
                updateOutput('api-output', data);
                log('Ecosystem stats retrieved', 'success');
            } catch (error) {
                updateOutput('api-output', { error: error.message });
                log(`API error: ${error.message}`, 'error');
            }
        }
        
        // Sync functions
        function forceSync() {
            log('Forcing sync...', 'info');
            window.GCABSyncEngine.forceSync();
            updateOutput('sync-output', 'Sync forced');
            log('Sync forced', 'info');
        }
        
        function getSyncStatus() {
            const status = window.GCABSyncEngine.getStatus();
            updateOutput('sync-output', status);
            log('Sync status retrieved', 'info');
        }
        
        function pauseSync() {
            window.GCABSyncEngine.pauseSync();
            document.getElementById('sync-status').textContent = 'Paused';
            updateOutput('sync-output', 'Sync paused');
            log('Sync paused', 'warning');
        }
        
        function resumeSync() {
            window.GCABSyncEngine.resumeSync();
            document.getElementById('sync-status').textContent = 'Running';
            updateOutput('sync-output', 'Sync resumed');
            log('Sync resumed', 'info');
        }
        
        // Initialize event listeners
        window.addEventListener('gcab:auth:changed', (event) => {
            log(`Auth changed: ${event.detail.type}`, 'info');
        });
        
        window.addEventListener('gcab:state:changed', (event) => {
            log(`State changed from ${event.detail.source}`, 'info');
        });
        
        window.GCABEventBridge.on('test:debug', (data) => {
            log(`Received test event: ${data.message}`, 'info');
        });
        
        // Auto-update status
        setInterval(() => {
            const authStatus = window.GCABAuth.isAuthenticated ? 'Connected' : 'Disconnected';
            document.getElementById('auth-status').textContent = authStatus;
            document.getElementById('auth-status').className = 
                `component-status ${window.GCABAuth.isAuthenticated ? 'status-active' : 'status-inactive'}`;
        }, 1000);
        
        // Initial log
        log('Test page initialized. Components ready.', 'success');
    </script>
</body>
</html>