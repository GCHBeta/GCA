<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCAB Analytics üìà</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Analytics specific styles */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--based-purple);
            border-radius: 15px;
            padding: 1.5rem;
            transition: transform 0.3s;
        }
        
        .chart-container:hover {
            transform: translateY(-5px);
        }
        
        .chart-title {
            color: var(--alpha-blue);
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .chart-wrapper {
            height: 300px;
            position: relative;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .data-table th {
            background: rgba(0, 238, 255, 0.1);
            color: var(--alpha-blue);
            padding: 1rem;
            text-align: left;
        }
        
        .data-table td {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .data-table tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid;
            border-radius: 10px;
            padding: 1.2rem;
            text-align: center;
            margin: 1rem 0;
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .metric-label {
            color: #888;
            font-size: 0.9rem;
        }
        
        .positive { color: var(--delusion-green); border-color: var(--delusion-green); }
        .negative { color: var(--liquidity-red); border-color: var(--liquidity-red); }
        .neutral { color: var(--beta-orange); border-color: var(--beta-orange); }
        
        @media (max-width: 768px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-wrapper {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="glitch-bg"></div>
    
    <header class="beta-header">
        <div class="logo-container">
            <h1 class="glitch-text" data-text="GCAB ANALYTICS">GCAB ANALYTICS</h1>
            <div class="beta-badge">LIVE DATA v0.9.9</div>
        </div>
        <nav class="beta-nav">
            <a href="index.html" class="nav-link">üè† Dashboard</a>
            <a href="analytics.html" class="nav-link active">üìä Analytics</a>
            <a href="https://gchbeta.github.io/GCA/" class="nav-link" target="_blank">üéÆ Play Game</a>
            <a href="memes.html" class="nav-link">üòÇ Memes</a>
            <a href="lore.html" class="nav-link">üìñ Lore</a>
        </nav>
    </header>

    <main class="dashboard">
        <!-- Market Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>üíé Current Price</h3>
                <div class="stat-value" id="current-price">$0.000000</div>
                <div class="stat-change positive">+5.2% (24h)</div>
            </div>
            
            <div class="stat-card">
                <h3>üìà Market Cap</h3>
                <div class="stat-value" id="market-cap">$36,420</div>
                <div class="stat-change positive">+12.5%</div>
            </div>
            
            <div class="stat-card">
                <h3>üë• Holders</h3>
                <div class="stat-value" id="holders">41</div>
                <div class="stat-change positive">+1 today</div>
            </div>
            
            <div class="stat-card">
                <h3>üíß Liquidity</h3>
                <div class="stat-value" id="liquidity">$650</div>
                <div class="stat-change neutral">+4%</div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="analytics-grid">
            <!-- Price Chart -->
            <div class="chart-container">
                <h3 class="chart-title"><i class="fas fa-chart-line"></i> PRICE HISTORY (7D)</h3>
                <div class="chart-wrapper">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>

            <!-- Holders Chart -->
            <div class="chart-container">
                <h3 class="chart-title"><i class="fas fa-users"></i> HOLDER GROWTH</h3>
                <div class="chart-wrapper">
                    <canvas id="holdersChart"></canvas>
                </div>
            </div>

            <!-- Volume Chart -->
            <div class="chart-container">
                <h3 class="chart-title"><i class="fas fa-exchange-alt"></i> TRADING VOLUME</h3>
                <div class="chart-wrapper">
                    <canvas id="volumeChart"></canvas>
                </div>
            </div>

            <!-- Distribution Chart -->
            <div class="chart-container">
                <h3 class="chart-title"><i class="fas fa-chart-pie"></i> HOLDER DISTRIBUTION</h3>
                <div class="chart-wrapper">
                    <canvas id="distributionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Metrics Grid -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin: 2rem 0;">
            <div class="metric-card positive">
                <div class="metric-label">Total Transactions</div>
                <div class="metric-value">1,284</div>
                <div>24h: +42</div>
            </div>
            
            <div class="metric-card positive">
                <div class="metric-label">Avg. Hold Time</div>
                <div class="metric-value">13.21d</div>
                <div>Diamond hands üíé</div>
            </div>
            
            <div class="metric-card neutral">
                <div class="metric-label">Top 10 Holders</div>
                <div class="metric-value">1.5%</div>
                <div>Of supply</div>
            </div>
            
            <div class="metric-card positive">
                <div class="metric-label">Social Score</div>
                <div class="metric-value">101/100</div>
                <div>Based engagement</div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="chart-container" style="margin-top: 2rem;">
            <h3 class="chart-title"><i class="fas fa-history"></i> RECENT TRANSACTIONS</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Value</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Time</th>
                    </tr>
                </thead>
                <tbody id="transactions-table">
                    <!-- Filled by JS -->
                </tbody>
            </table>
        </div>
    </main>

    <footer class="beta-footer">
        <div class="footer-content">
            <p><strong>GCAB ANALYTICS v0.9.9</strong> | Real-time on-chain data & metrics</p>
            <p>Data updates every 30 seconds | Powered by Base blockchain</p>
            <p class="easter-egg-hint">Analytics don't lie... unless they're based on copium</p>
        </div>
    </footer>

    <script>
        // ===== CONFIG =====
        const CONTRACT = '0x6d0B8eB75E9d6735cc301c3a6E82adeE43590B07';
        
        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìà GCAB Analytics Initializing...');
            
            // Create charts
            createPriceChart();
            createHoldersChart();
            createVolumeChart();
            createDistributionChart();
            
            // Load data
            updateMetrics();
            loadTransactions();
            
            // Start auto-refresh
            setInterval(updateMetrics, 30000);
            
            console.log('‚úÖ GCAB Analytics Ready');
        });

        // ===== CHART FUNCTIONS =====
        function createPriceChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const prices = [0.00000008, 0.00000009, 0.000000085, 0.000000095, 0.0000001, 0.000000105, 0.0000001];
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'GCAB Price',
                        data: prices,
                        borderColor: '#00eeff',
                        backgroundColor: 'rgba(0, 238, 255, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { 
                                color: '#888',
                                callback: function(value) {
                                    return '$' + value.toFixed(6);
                                }
                            }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#888' }
                        }
                    }
                }
            });
        }

        function createHoldersChart() {
            const ctx = document.getElementById('holdersChart').getContext('2d');
            const days = ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'];
            const holders = [1, 3, 5, 8, 13, 21, 34, 41];
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: days,
                    datasets: [{
                        label: 'Holders',
                        data: holders,
                        backgroundColor: 'rgba(0, 255, 170, 0.6)',
                        borderColor: '#00ffaa',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#888' }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#888' }
                        }
                    }
                }
            });
        }

        function createVolumeChart() {
            const ctx = document.getElementById('volumeChart').getContext('2d');
            const hours = ['12am', '4am', '8am', '12pm', '4pm', '8pm'];
            const volume = [.50, .800, 1.200, 2.500, 1.800, .900];
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hours,
                    datasets: [{
                        label: 'Volume (USD)',
                        data: volume,
                        borderColor: '#ffaa00',
                        backgroundColor: 'rgba(255, 170, 0, 0.1)',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { 
                                color: '#888',
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        },
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.1)' },
                            ticks: { color: '#888' }
                        }
                    }
                }
            });
        }

        function createDistributionChart() {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: [ 'Supply (80-99.91%)', 'Whales (>1%)', 'Dolphins (0.1-1%)', 'Fish (0.01-0.1%)', 'Shrimp (<0.01%)'],
                    datasets: [{
                        data: [98, .99, 1, .025, .01],
                        backgroundColor: [
                            '#00eeff',
                            '#ffaa00',
                            '#9d00ff',
                            '#ff0055'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#888' }
                        }
                    }
                }
            });
        }

        // ===== DATA FUNCTIONS =====
        function updateMetrics() {
            // Simulate live data updates
            const price = 0.00001 + (Math.random() * 0.000005 - 0.0000025);
            const holders = 284 + Math.floor(Math.random() * 3);
            const marketCap = 50000 + Math.random() * 5000;
            const liquidity = 2150 + Math.random() * 200;
            
            document.getElementById('current-price').textContent = 
                '$' + price.toFixed(6);
            document.getElementById('market-cap').textContent = 
                '$' + Math.floor(marketCap).toLocaleString();
            document.getElementById('holders').textContent = holders;
            document.getElementById('liquidity').textContent = 
                '$' + Math.floor(liquidity).toLocaleString();
        }

        function loadTransactions() {
            const transactions = [
                { type: 'Buy', amount: '10,000 GCAB', value: '$100', from: 'Uniswap', to: '0x123...', time: '2 min ago' },
                { type: 'Sell', amount: '5,000 GCAB', value: '$50', from: '0x456...', to: 'Uniswap', time: '5 min ago' },
                { type: 'Buy', amount: '25,000 GCAB', value: '$250', from: 'Uniswap', to: '0x789...', time: '12 min ago' },
                { type: 'Transfer', amount: '1,000 GCAB', value: '$10', from: '0xabc...', to: '0xdef...', time: '18 min ago' },
                { type: 'Buy', amount: '50,000 GCAB', value: '$500', from: 'Uniswap', to: '0xghi...', time: '25 min ago' }
            ];
            
            const table = document.getElementById('transactions-table');
            table.innerHTML = '';
            
            transactions.forEach(tx => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span style="color: ${tx.type === 'Buy' ? '#00ffaa' : tx.type === 'Sell' ? '#ff0055' : '#ffaa00'}">
                        ${tx.type}
                    </span></td>
                    <td>${tx.amount}</td>
                    <td>${tx.value}</td>
                    <td>${tx.from}</td>
                    <td>${tx.to}</td>
                    <td>${tx.time}</td>
                `;
                table.appendChild(row);
            });
        }

// Analytics with real data
let analyticsCharts = {};

async function loadAnalyticsData() {
    try {
        const data = await GCABData.getLiveData();
        
        // Update all metrics
        updateMetrics(data);
        
        // Update charts
        updateCharts(data);
        
        // Update transaction table
        updateTransactionTable(data.transactions);
        
        // Show data status
        document.getElementById('data-status').innerHTML = 
            `<span style="color: ${data.isReal ? '#00ffaa' : '#ffaa00'}">
                ${data.isReal ? 'üü¢ LIVE' : 'üü° MOCK'} ‚Ä¢ ${data.lastUpdated}
            </span>`;
            
    } catch (error) {
        console.error('Analytics data error:', error);
    }
}

function updateMetrics(data) {
    const metrics = {
        'current-price': GCABData.formatPrice(data.market.price),
        'price-change': `${data.market.priceChange24h >= 0 ? '+' : ''}${data.market.priceChange24h.toFixed(2)}%`,
        'market-cap': GCABData.formatNumber(data.market.fdv),
        'holders': GCABData.formatLargeNumber(data.holders.count),
        'liquidity': GCABData.formatNumber(data.market.liquidity),
        'volume-24h': GCABData.formatNumber(data.market.volume24h)
    };
    
    Object.keys(metrics).forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.textContent = metrics[id];
            
            // Color code price change
            if (id === 'price-change') {
                el.className = GCABData.getPriceChangeClass(data.market.priceChange24h);
            }
        }
    });
}

function updateCharts(data) {
    // Update price chart with real data
    if (analyticsCharts.priceChart) {
        const now = new Date();
        const label = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
        
        analyticsCharts.priceChart.data.labels.push(label);
        analyticsCharts.priceChart.data.datasets[0].data.push(data.market.price);
        
        // Keep last 12 points
        if (analyticsCharts.priceChart.data.labels.length > 12) {
            analyticsCharts.priceChart.data.labels.shift();
            analyticsCharts.priceChart.data.datasets[0].data.shift();
        }
        
        analyticsCharts.priceChart.update('none');
    }
}

function updateTransactionTable(transactions) {
    const table = document.getElementById('transactions-table');
    if (!table) return;
    
    table.innerHTML = '';
    
    transactions.forEach(tx => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><span style="color: ${tx.type === 'BUY' ? '#00ffaa' : tx.type === 'SELL' ? '#ff0055' : '#ffaa00'}">
                ${tx.type}
            </span></td>
            <td>${tx.value} GCAB</td>
            <td>$${(parseFloat(tx.value) * (window.currentPrice || 0.00001)).toFixed(2)}</td>
            <td>${tx.from}</td>
            <td>${tx.to}</td>
            <td>${getTimeAgo(tx.timestamp)}</td>
        `;
        table.appendChild(row);
    });
}

// Initialize analytics page
if (document.querySelector('.analytics-grid')) {
    document.addEventListener('DOMContentLoaded', function() {
        // Load Chart.js if not already loaded
        if (typeof Chart === 'undefined') {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
            script.onload = initializeAnalytics;
            document.head.appendChild(script);
        } else {
            initializeAnalytics();
        }
        
        function initializeAnalytics() {
            createCharts();
            loadAnalyticsData();
            setInterval(loadAnalyticsData, 30000);
        }
    });
}

        // ===== HELPER FUNCTIONS =====
        function refreshData() {
            updateMetrics();
            loadTransactions();
            
            // Show notification
            const notification = document.createElement('div');
            notification.textContent = 'Data refreshed!';
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--based-purple);
                color: white;
                padding: 0.8rem 1.5rem;
                border-radius: 8px;
                z-index: 1000;
                animation: fadeIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 2000);
        }

        // Add animation styles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            @keyframes fadeOut {
                from { opacity: 1; transform: translateY(0); }
                to { opacity: 0; transform: translateY(10px); }
            }
        `;
        document.head.appendChild(style);

        // Auto-refresh button
        setTimeout(() => {
            const refreshBtn = document.createElement('button');
            refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Refresh Data';
            refreshBtn.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 20px;
                background: var(--alpha-blue);
                color: var(--bg-dark);
                border: none;
                border-radius: 8px;
                padding: 0.8rem 1.5rem;
                font-family: inherit;
                font-weight: bold;
                cursor: pointer;
                z-index: 1000;
                transition: transform 0.3s;
            `;
            refreshBtn.onclick = refreshData;
            refreshBtn.onmouseover = () => refreshBtn.style.transform = 'scale(1.05)';
            refreshBtn.onmouseout = () => refreshBtn.style.transform = 'scale(1)';
            
            document.body.appendChild(refreshBtn);
        }, 1000);
    </script>
</body>
</html>